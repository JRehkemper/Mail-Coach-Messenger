<!DOCTYPE html>
<html>
    <head>
        <title>Chatroom</title>
        <meta charset="utf-8">
        <meta name="description" content="The HTML5 Herald">
        <meta name="author" content="SitePoint">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="text/css" rel="stylesheet" href="/css/style.css">

        <!-- Bootstrap css-->
        <link type="text/css" rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">      
    </head>
    
    <body>
        <div class="container-fluid" >
            <div class="row" style="margin-top: 10vh;">
                <div class="col-2 d-none d-sm-none d-md-none">
                    
                </div>
                <div class="col-lg-8 col-xl-8 mx-auto HeaderDiv p-3" style="box-shadow: 0px 0px 2em 5px #111;">
                    <div class="Header p-4 sticky-top">
                        <h1 class="text-center">Realtime Chatroom</h1>
                        <p class="text-center">A bad, unreliable und unsafe way of communication</p>
                        <!--<p class="text-center" id="usercountId">Users</p>-->
                    </div>
                    <div class="Chatarea">
                        <div class="col-lg-10 col-xl-8 mx-auto pt-3">
                            <ul id="messages" style="min-height: 65vh;">

                            </ul>
                        </div>
                        <!-- Chatinput -->
                        <div class="row" >
                            <div class="col-12 col-lg-8 col-xl-8 mx-auto fixed-bottom formBackground">
                                <div class="col-12 col-lg-10 col-xl-8 mx-auto ">
                                    <form id="form" action="">
                                        <input class="col-9 col-lg-9 col-xl-10" id="input" autocomplete="off" /><button class="col-3 col-lg-3 col-xl-2 text-center">Send</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-2 d-none d-sm-none d-md-none">

                </div>
            </div>
        </div>
        
        <!-- Bootstrap scripts -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.6.0/umd/popper.min.js" integrity="sha512-BmM0/BQlqh02wuK5Gz9yrbe7VyIVwOzD1o40yi1IsTjriX/NGF37NyXHfmFzIlMmoSIBXgqDiG1VNU6kB5dBbA==" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var audio = new Audio('sound/messageSound.mp3');
            audio.volume = 0.2;
            var socket = io();
            var messages = document.getElementById('messages');
            var form = document.getElementById('form');
            var input = document.getElementById('input');
            var usercountId = document.getElementById('usercountID');
            

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (input.value) {
                    socket.emit('chat message', input.value);
                    input.value = '';
                }
            });

            socket.on('connection', function() {
                var item = document.createElement('li');
                item.textContent = "User joind the Chat";
                messages.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);
                audio.play();
            })

            socket.on('disconnected', function() {
                var item = document.createElement('li');
                item.textContent = "User left the Chat";
                messages.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);
                audio.play();
            })

            socket.on('chat message', function(msg) {
                var item = document.createElement('li');
                item.textContent = msg;
                messages.appendChild(item);
                window.scrollTo(0, document.body.scrollHeight);
                audio.play();
            });

            /*socket.on('usercount', function(usercount) {
                document.getElementById('usercountId').innerHTML = "Connected User: " + usercount;
            });*/
        </script>
    </body>
</html>